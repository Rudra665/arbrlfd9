<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Video Player</title>
    <script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
    <script src="https://rawcdn.githack.com/oscarmarinmiro/aframe-youtube-component/v4.2.0/dist/aframe-youtube-component.min.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
</head>
<body style="margin: 0; overflow: hidden;">
    <a-scene
        vr-mode-ui="enabled: false"
        loading-screen="enabled: false;"
        arjs='sourceType: webcam; debugUIEnabled: false;'
        embedded
        gesture-detector
        youtube
    >
        <a-marker
            type="pattern"
            url="./assets/pattern-default-marker.patt"
            videohandler
            smooth="true"
            smoothCount="10"
            smoothTolerance="0.01"
            smoothThreshold="5"
            raycaster="objects: .clickable"
            emitevents="true"
            cursor="fuse: false; rayOrigin: mouse;"
            id="markerA"
        >
            <!-- Container for video iframe -->
            <iframe src="https://www.youtube.com/watch?v=boNTSR1rCz8"/>
<!--             <div id="videoContainer" class="clickable"></div> -->
        </a-marker>

        <a-entity camera></a-entity>
    </a-scene>

    <script>
        var player;

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('videoContainer', {
                videoId: 'Vb7W6yMOZaw', // Placeholder for YouTube video ID
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            console.log('Video is ready to play');
            // Automatically start playing the video when ready
            player.playVideo();
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                console.log('Video is playing');
                // You can perform actions here when the video is playing
            } else if (event.data == YT.PlayerState.PAUSED) {
                console.log('Video is paused');
                // You can perform actions here when the video is paused
            } else if (event.data == YT.PlayerState.ENDED) {
                console.log('Video has ended');
                // You can perform actions here when the video has ended
            }
            // Handle other state changes as needed
        }

        AFRAME.registerComponent('videohandler', {
            init: function () {
                var marker = this.el;
                var container = document.getElementById('videoContainer');

                marker.addEventListener('markerFound', function () {
                    var videoSource = 'https://www.youtube.com/watch?v=O3CCnhqLDfQ'; // Replace with actual video URL or ID

                    var videoType = '';

                    if (videoSource.includes('youtube.com') || videoSource.includes('youtu.be')) {
                        videoType = 'youtube';
                        var videoId = getYouTubeVideoId(videoSource);
                        if (videoId) {
                            player.loadVideoById(videoId);
                        } else {
                            alert('Invalid YouTube URL or ID.');
                        }
                    } else if (videoSource.includes('.mp4')) {
                        videoType = 'local';
                        container.innerHTML = `<video src="${videoSource}" autoplay loop></video>`;
                    } else {
                        videoType = 'external';
                        container.innerHTML = `<iframe src="${videoSource}" frameborder="0" allowfullscreen></iframe>`;
                    }

                    function getYouTubeVideoId(url) {
                        var videoId = 'Vb7W6yMOZaw';
                        if (url.includes('youtube.com') && url.includes('v=')) {
                            var params = new URLSearchParams(new URL(url).search);
                            videoId = params.get('v');
                        } else if (url.includes('youtu.be/')) {
                            videoId = url.split('youtu.be/')[1];
                        }
                        return videoId;
                    }
                });

                marker.addEventListener('markerLost', function () {
                    container.innerHTML = ''; // Clear the video container
                    if (player && player.stopVideo) {
                        player.stopVideo();
                    }
                });
            },
        });
    </script>
</body>
</html>
